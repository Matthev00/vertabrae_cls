
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Mateusz Ostaszewski">
      
      
      
        <link rel="prev" href="../../commands/">
      
      
        <link rel="next" href="../training/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Data preparation - Vertebrae Classifier</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indygo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-preparation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Vertebrae Classifier" class="md-header__button md-logo" aria-label="Vertebrae Classifier" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Vertebrae Classifier
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Data preparation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indygo" data-md-color-accent="indigo"  aria-label="Tryb ciemny"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Tryb ciemny" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indygo" data-md-color-accent="indigo"  aria-label="Tryb jasny"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Tryb jasny" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Vertebrae Classifier" class="md-nav__button md-logo" aria-label="Vertebrae Classifier" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Vertebrae Classifier
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commands
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Code Docs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Code Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Data preparation
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Data preparation
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.data_utils.XLSExtractor" class="md-nav__link">
    <span class="md-ellipsis">
      XLSExtractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="XLSExtractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.XLSExtractor.XLSExtractor" class="md-nav__link">
    <span class="md-ellipsis">
      XLSExtractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="XLSExtractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.XLSExtractor.XLSExtractor.extract_and_save" class="md-nav__link">
    <span class="md-ellipsis">
      extract_and_save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.data_utils.dicom_reader" class="md-nav__link">
    <span class="md-ellipsis">
      dicom_reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dicom_reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dicom_reader.DICOMReader" class="md-nav__link">
    <span class="md-ellipsis">
      DICOMReader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DICOMReader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dicom_reader.DICOMReader.load_dicom_series_with_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      load_dicom_series_with_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dicom_reader.DICOMReader.process_dicom_series" class="md-nav__link">
    <span class="md-ellipsis">
      process_dicom_series
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.data_utils.vertebra_extractor" class="md-nav__link">
    <span class="md-ellipsis">
      vertebra_extractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="vertebra_extractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.vertebra_extractor.VertebraExtractor" class="md-nav__link">
    <span class="md-ellipsis">
      VertebraExtractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VertebraExtractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.vertebra_extractor.VertebraExtractor.get_segmentation" class="md-nav__link">
    <span class="md-ellipsis">
      get_segmentation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_utils.vertebra_extractor.VertebraExtractor.extract_vertebrae_with_neighbors" class="md-nav__link">
    <span class="md-ellipsis">
      extract_vertebrae_with_neighbors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator" class="md-nav__link">
    <span class="md-ellipsis">
      dataset_creator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset_creator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator.DatasetCreator" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetCreator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetCreator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator.DatasetCreator.process_patient" class="md-nav__link">
    <span class="md-ellipsis">
      process_patient
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator.DatasetCreator.extract_dir_name" class="md-nav__link">
    <span class="md-ellipsis">
      extract_dir_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator.DatasetCreator.get_max_index" class="md-nav__link">
    <span class="md-ellipsis">
      get_max_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator.DatasetCreator.save_patient_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_patient_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator.DatasetCreator.create_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      create_dataset
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Training
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modeling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modeling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.data_utils.XLSExtractor" class="md-nav__link">
    <span class="md-ellipsis">
      XLSExtractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="XLSExtractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.XLSExtractor.XLSExtractor" class="md-nav__link">
    <span class="md-ellipsis">
      XLSExtractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="XLSExtractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.XLSExtractor.XLSExtractor.extract_and_save" class="md-nav__link">
    <span class="md-ellipsis">
      extract_and_save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.data_utils.dicom_reader" class="md-nav__link">
    <span class="md-ellipsis">
      dicom_reader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dicom_reader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dicom_reader.DICOMReader" class="md-nav__link">
    <span class="md-ellipsis">
      DICOMReader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DICOMReader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dicom_reader.DICOMReader.load_dicom_series_with_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      load_dicom_series_with_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dicom_reader.DICOMReader.process_dicom_series" class="md-nav__link">
    <span class="md-ellipsis">
      process_dicom_series
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.data_utils.vertebra_extractor" class="md-nav__link">
    <span class="md-ellipsis">
      vertebra_extractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="vertebra_extractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.vertebra_extractor.VertebraExtractor" class="md-nav__link">
    <span class="md-ellipsis">
      VertebraExtractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VertebraExtractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.vertebra_extractor.VertebraExtractor.get_segmentation" class="md-nav__link">
    <span class="md-ellipsis">
      get_segmentation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_utils.vertebra_extractor.VertebraExtractor.extract_vertebrae_with_neighbors" class="md-nav__link">
    <span class="md-ellipsis">
      extract_vertebrae_with_neighbors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator" class="md-nav__link">
    <span class="md-ellipsis">
      dataset_creator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset_creator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator.DatasetCreator" class="md-nav__link">
    <span class="md-ellipsis">
      DatasetCreator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetCreator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator.DatasetCreator.process_patient" class="md-nav__link">
    <span class="md-ellipsis">
      process_patient
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator.DatasetCreator.extract_dir_name" class="md-nav__link">
    <span class="md-ellipsis">
      extract_dir_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator.DatasetCreator.get_max_index" class="md-nav__link">
    <span class="md-ellipsis">
      get_max_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator.DatasetCreator.save_patient_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_patient_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.data_utils.dataset_creator.DatasetCreator.create_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      create_dataset
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="data-preparation">Data preparation</h1>


<div class="doc doc-object doc-module">



<h2 id="src.data_utils.XLSExtractor" class="doc doc-heading">
            <code>src.data_utils.XLSExtractor</code>


</h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.data_utils.XLSExtractor.XLSExtractor" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">XLSExtractor</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">


        <p>A class to extract data from XLS files.</p>

        <p>Initializes the XLSExtractor with the path to the XLS file.</p>
<p>:param file_path: Path to the XLS file.</p>







                  <details class="quote">
                    <summary>Source code in <code>src/data_utils/XLSExtractor.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes the XLSExtractor with the path to the XLS file.</span>

<span class="sd">    :param file_path: Path to the XLS file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.data_utils.XLSExtractor.XLSExtractor.extract_and_save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_and_save</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Extracts records from the XLS file and saves them to a CSV file.</p>
<p>:param output_path: Path to save the CSV file.</p>


            <details class="quote">
              <summary>Source code in <code>src/data_utils/XLSExtractor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_and_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts records from the XLS file and saves them to a CSV file.</span>

<span class="sd">    :param output_path: Path to save the CSV file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_drop_irrelevant_columns</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_extract_records</span><span class="p">()</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">)</span>
    <span class="n">output_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="src.data_utils.dicom_reader" class="doc doc-heading">
            <code>src.data_utils.dicom_reader</code>


</h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.data_utils.dicom_reader.DICOMReader" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">DICOMReader</span><span class="p">(</span><span class="n">patient_dir</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">


        <p>Class to read DICOM files and convert them to PyTorch tensors.</p>

        <p>Initialize the DICOMReader with the directory containing DICOM files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>patient_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory containing DICOM files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>src/data_utils/dicom_reader.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the DICOMReader with the directory containing DICOM files.</span>

<span class="sd">    Args:</span>
<span class="sd">        patient_dir (Path): Directory containing DICOM files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">patient_dir</span> <span class="o">=</span> <span class="n">patient_dir</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.data_utils.dicom_reader.DICOMReader.load_dicom_series_with_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_dicom_series_with_metadata</span><span class="p">(</span><span class="n">series_dir</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Read a DICOM series from a directory and return the image tensor, series description, and metadata.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>series_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the directory containing DICOM series.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code><span title="tuple">tuple</span>[<span title="torch.Tensor">Tensor</span>, <span title="str">str</span>, <span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
- torch.Tensor: The image tensor.
- str: The series description.
- dict: Metadata including spacing, direction, and origin.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no DICOM series is found in the directory.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/data_utils/dicom_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_dicom_series_with_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a DICOM series from a directory and return the image tensor, series description, and metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">        series_dir (str): Path to the directory containing DICOM series.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing:</span>
<span class="sd">            - torch.Tensor: The image tensor.</span>
<span class="sd">            - str: The series description.</span>
<span class="sd">            - dict: Metadata including spacing, direction, and origin.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no DICOM series is found in the directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">sitk</span><span class="o">.</span><span class="n">ImageSeriesReader</span><span class="p">()</span>
    <span class="n">dicom_series</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">GetGDCMSeriesFileNames</span><span class="p">(</span><span class="n">series_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dicom_series</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Did not find any DICOM Series in: </span><span class="si">{</span><span class="n">series_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">reader</span><span class="o">.</span><span class="n">SetFileNames</span><span class="p">(</span><span class="n">dicom_series</span><span class="p">)</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">Execute</span><span class="p">()</span>
    <span class="n">tensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_dicom_to_tensor</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_image_metadata</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="n">series_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_series_description</span><span class="p">(</span><span class="n">dicom_series</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">tensor</span><span class="p">,</span> <span class="n">series_description</span><span class="p">,</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.data_utils.dicom_reader.DICOMReader.process_dicom_series" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_dicom_series</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Processes DICOM series from a root folder, selects a tensor based on priority.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dicom_root_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the root folder containing DICOM series.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[Optional[torch.Tensor], Optional[str], Optional[dict]]: The selected tensor,</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>its description, and metadata. Returns None if no tensor is found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no DICOM series are found in the directory.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/data_utils/dicom_reader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_dicom_series</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes DICOM series from a root folder, selects a tensor based on priority.</span>

<span class="sd">    Args:</span>
<span class="sd">        dicom_root_folder (str): Path to the root folder containing DICOM series.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[Optional[torch.Tensor], Optional[str], Optional[dict]]: The selected tensor,</span>
<span class="sd">        its description, and metadata. Returns None if no tensor is found.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no DICOM series are found in the directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">series_tensors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_all_dicom_series</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_tensor_by_priority</span><span class="p">(</span><span class="n">series_tensors</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="src.data_utils.vertebra_extractor" class="doc doc-heading">
            <code>src.data_utils.vertebra_extractor</code>


</h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.data_utils.vertebra_extractor.VertebraExtractor" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">VertebraExtractor</span><span class="p">(</span><span class="n">is_full_resolution</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">))</span></code>

</h3>


    <div class="doc doc-contents ">


        <p>A class to extract specific vertebrae from CT images.</p>

        <p>Initialize the VertebraExtractor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>is_full_resolution</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, use full resolution model.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="torch.device">device</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The device to run the model on.</p>
              </div>
            </td>
            <td>
                  <code><span title="torch.device">device</span>(&#39;cuda&#39;)</code>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>src/data_utils/vertebra_extractor.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">is_full_resolution</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the VertebraExtractor.</span>

<span class="sd">    Args:</span>
<span class="sd">        is_full_resolution (bool): If True, use full resolution model.</span>
<span class="sd">        device (torch.device): The device to run the model on.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pixdim</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_full_resolution</span> <span class="k">else</span> <span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">Compose</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">LoadImaged</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]),</span>
            <span class="n">EnsureTyped</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]),</span>
            <span class="n">EnsureChannelFirstd</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]),</span>
            <span class="n">Orientationd</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">],</span> <span class="n">axcodes</span><span class="o">=</span><span class="s2">&quot;RAS&quot;</span><span class="p">),</span>
            <span class="n">Spacingd</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">],</span> <span class="n">pixdim</span><span class="o">=</span><span class="n">pixdim</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">),</span>
            <span class="n">NormalizeIntensityd</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">],</span> <span class="n">nonzero</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">ScaleIntensityd</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">],</span> <span class="n">minv</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">maxv</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_full_resolution</span> <span class="o">=</span> <span class="n">is_full_resolution</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_model</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transformed_input_tensor</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.data_utils.vertebra_extractor.VertebraExtractor.get_segmentation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_segmentation</span><span class="p">(</span><span class="n">raw_tensor</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get the segmentation of the input tensor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>raw_tensor</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Metadata for the tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="torch.Tensor">Tensor</span>, <span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[torch.Tensor, torch.Tensor]: The segmentation tensor and the input tensor.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/data_utils/vertebra_extractor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_segmentation</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">raw_tensor</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the segmentation of the input tensor.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_tensor (torch.Tensor): The input tensor.</span>
<span class="sd">        metadata (dict): Metadata for the tensor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[torch.Tensor, torch.Tensor]: The segmentation tensor and the input tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transformed_tensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_data</span><span class="p">(</span><span class="n">raw_tensor</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">inference_mode</span><span class="p">():</span>
        <span class="n">input_tensor</span> <span class="o">=</span> <span class="n">transformed_tensor</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sliding_window_inference</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="n">input_tensor</span><span class="p">,</span>
            <span class="n">roi_size</span><span class="o">=</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">96</span><span class="p">),</span>
            <span class="n">sw_batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">predictor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">overlap</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;gaussian&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">input_tensor</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.data_utils.vertebra_extractor.VertebraExtractor.extract_vertebrae_with_neighbors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_vertebrae_with_neighbors</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">target_vertebrae</span><span class="p">,</span> <span class="n">target_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Extract the specified vertebrae and its neighbors from the input tensor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input_tensor</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Metadata for the tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_vertebrae</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The vertebrae to extract.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_size</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target size for resizing.
If None, the original size will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[torch.Tensor]: The extracted vertebrae tensor, or None if no vertebrae are found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/data_utils/vertebra_extractor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_vertebrae_with_neighbors</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_tensor</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">target_vertebrae</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">target_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the specified vertebrae and its neighbors from the input tensor.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_tensor (torch.Tensor): The input tensor.</span>
<span class="sd">        metadata (dict): Metadata for the tensor.</span>
<span class="sd">        target_vertebrae (str): The vertebrae to extract.</span>
<span class="sd">        target_size (tuple[int, int, int], optional): The target size for resizing.</span>
<span class="sd">            If None, the original size will be used.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[torch.Tensor]: The extracted vertebrae tensor, or None if no vertebrae are found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">target_label</span> <span class="o">=</span> <span class="n">VERTEBRAE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target_vertebrae</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">target_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid target vertebrae: </span><span class="si">{</span><span class="n">target_vertebrae</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">target_label</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">target_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="n">target_label</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="n">target_label</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformed_input_tensor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformed_input_tensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_segmentation</span><span class="p">(</span>
            <span class="n">input_tensor</span><span class="p">,</span> <span class="n">metadata</span>
        <span class="p">)</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No vertebrae found in the segmentation.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">zmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">zmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">target_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformed_input_tensor</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">zmin</span><span class="p">:</span><span class="n">zmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span> <span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resize_vertebrae_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformed_input_tensor</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">target_size</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="src.data_utils.dataset_creator" class="doc doc-heading">
            <code>src.data_utils.dataset_creator</code>


</h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.data_utils.dataset_creator.DatasetCreator" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">DatasetCreator</span><span class="p">(</span><span class="n">raport_file_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">


        <p>Class to create datasets for vertebrae segmentation.</p>

        <p>Initialize the DatasetCreator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>raport_file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to raport file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>src/data_utils/dataset_creator.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raport_file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the DatasetCreator.</span>

<span class="sd">    Args:</span>
<span class="sd">        raport_file_path (Path): Path to raport file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">raport_file_path</span> <span class="o">=</span> <span class="n">raport_file_path</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.data_utils.dataset_creator.DatasetCreator.process_patient" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_patient</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">injuried_vertebrae</span><span class="p">,</span> <span class="n">target_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_healthy</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Process a patient's DICOM files and extract vertebrae data.
This function reads the DICOM files, extracts the vertebrae and their injuries,
and returns a list of dictionaries containing the vertebrae data.
Additionally, it extracts a specified number of random healthy vertebrae not listed as injured.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dir_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory name of the patient.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>injuried_vertebrae</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of tuples containing vertebrae information (vertebra, injury_type).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_size</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target size for the extracted tensors.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_healthy</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of healthy vertebrae to extract.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict]: List of dictionaries containing vertebrae data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/data_utils/dataset_creator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_patient</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">injuried_vertebrae</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
    <span class="n">target_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_healthy</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process a patient&#39;s DICOM files and extract vertebrae data.</span>
<span class="sd">    This function reads the DICOM files, extracts the vertebrae and their injuries,</span>
<span class="sd">    and returns a list of dictionaries containing the vertebrae data.</span>
<span class="sd">    Additionally, it extracts a specified number of random healthy vertebrae not listed as injured.</span>

<span class="sd">    Args:</span>
<span class="sd">        dir_name (str): Directory name of the patient.</span>
<span class="sd">        injuried_vertebrae (list[tuple[str, str]]): List of tuples containing vertebrae information (vertebra, injury_type).</span>
<span class="sd">        target_size (tuple[int, int, int], optional): Target size for the extracted tensors.</span>
<span class="sd">        num_healthy (int): Number of healthy vertebrae to extract.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict]: List of dictionaries containing vertebrae data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">patient_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dir_path</span> <span class="o">=</span> <span class="n">DICOM_DATA_DIR</span> <span class="o">/</span> <span class="n">dir_name</span>
    <span class="n">dicom_reader</span> <span class="o">=</span> <span class="n">DICOMReader</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
    <span class="n">tensor</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">dicom_reader</span><span class="o">.</span><span class="n">process_dicom_series</span><span class="p">()</span>
    <span class="n">vertebra_extractor</span> <span class="o">=</span> <span class="n">VertebraExtractor</span><span class="p">(</span><span class="n">IS_FULL_RESOLUTION</span><span class="p">,</span> <span class="n">DEVICE</span><span class="p">)</span>

    <span class="n">patient_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_injured_vertebrae</span><span class="p">(</span>
            <span class="n">vertebra_extractor</span><span class="p">,</span> <span class="n">tensor</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">injuried_vertebrae</span><span class="p">,</span> <span class="n">target_size</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">patient_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_healthy_vertebrae</span><span class="p">(</span>
            <span class="n">vertebra_extractor</span><span class="p">,</span>
            <span class="n">tensor</span><span class="p">,</span>
            <span class="n">metadata</span><span class="p">,</span>
            <span class="n">dir_name</span><span class="p">,</span>
            <span class="n">injuried_vertebrae</span><span class="p">,</span>
            <span class="n">target_size</span><span class="p">,</span>
            <span class="n">num_healthy</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">patient_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.data_utils.dataset_creator.DatasetCreator.extract_dir_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_dir_name</span><span class="p">(</span><span class="n">dir_id</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Finds a single directory in DICOM_DATA_DIR whose name contains the given dir_id
as the second space-separated component.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dir_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory ID to match (e.g. '303').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The matching directory name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no matching directory is found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/data_utils/dataset_creator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_dir_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds a single directory in DICOM_DATA_DIR whose name contains the given dir_id</span>
<span class="sd">    as the second space-separated component.</span>

<span class="sd">    Args:</span>
<span class="sd">        dir_id (str): The directory ID to match (e.g. &#39;303&#39;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The matching directory name.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If no matching directory is found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">DICOM_DATA_DIR</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">dir_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;No directory found in </span><span class="si">{</span><span class="n">DICOM_DATA_DIR</span><span class="si">}</span><span class="s2"> with ID &#39;</span><span class="si">{</span><span class="n">dir_id</span><span class="si">}</span><span class="s2">&#39; as second part.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.data_utils.dataset_creator.DatasetCreator.get_max_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_max_index</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Gets max existing tensor index.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>max existing tensor index.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/data_utils/dataset_creator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_max_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets max existing tensor index.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: max existing tensor index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">existing_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">TENSOR_DIR</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.pt&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">existing_files</span><span class="p">:</span>
        <span class="n">max_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">existing_files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">isdigit</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">max_index</span>
    <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.data_utils.dataset_creator.DatasetCreator.save_patient_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_patient_data</span><span class="p">(</span><span class="n">patient_data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Save processed vertebra data as tensors and append metadata to a CSV file.</p>
<p>Each tensor is saved to <code>TENSOR_DIR</code> using a sequential 5-digit filename (e.g., "00001.pt").
Corresponding metadata including vertebra name, injury type, patient ID (II), and file path
is appended to the CSV file at <code>LABELS_FILE_PATH</code>. If the CSV does not exist, it is created.</p>
<p>This function is designed to support resumable dataset creation — partial results are not lost
in case of interruption.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>patient_data</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of dictionaries, where each dictionary contains:
- "target_tensor" (torch.Tensor): The extracted vertebra tensor.
- "vertebra" (str): Name of the vertebra (e.g., "L1").
- "injury_type" (str): Injury classification (e.g., "A1").
- "II" (str): Patient ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/data_utils/dataset_creator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_patient_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save processed vertebra data as tensors and append metadata to a CSV file.</span>

<span class="sd">    Each tensor is saved to `TENSOR_DIR` using a sequential 5-digit filename (e.g., &quot;00001.pt&quot;).</span>
<span class="sd">    Corresponding metadata including vertebra name, injury type, patient ID (II), and file path</span>
<span class="sd">    is appended to the CSV file at `LABELS_FILE_PATH`. If the CSV does not exist, it is created.</span>

<span class="sd">    This function is designed to support resumable dataset creation — partial results are not lost</span>
<span class="sd">    in case of interruption.</span>

<span class="sd">    Args:</span>
<span class="sd">        patient_data (list[dict]):</span>
<span class="sd">            A list of dictionaries, where each dictionary contains:</span>
<span class="sd">            - &quot;target_tensor&quot; (torch.Tensor): The extracted vertebra tensor.</span>
<span class="sd">            - &quot;vertebra&quot; (str): Name of the vertebra (e.g., &quot;L1&quot;).</span>
<span class="sd">            - &quot;injury_type&quot; (str): Injury classification (e.g., &quot;A1&quot;).</span>
<span class="sd">            - &quot;II&quot; (str): Patient ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labels_file_exists</span> <span class="o">=</span> <span class="n">LABELS_FILE_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
    <span class="n">next_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_max_index</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">LABELS_FILE_PATH</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span>
            <span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;vertebra&quot;</span><span class="p">,</span> <span class="s2">&quot;injury_type&quot;</span><span class="p">,</span> <span class="s2">&quot;II&quot;</span><span class="p">,</span> <span class="s2">&quot;tensor_path&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">labels_file_exists</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">patient_data</span><span class="p">:</span>
            <span class="n">tensor</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;target_tensor&quot;</span><span class="p">]</span>
            <span class="n">vertebra</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;vertebra&quot;</span><span class="p">]</span>
            <span class="n">injury_type</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;injury_type&quot;</span><span class="p">]</span>
            <span class="n">II</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;II&quot;</span><span class="p">]</span>

            <span class="n">tensor_file_path</span> <span class="o">=</span> <span class="n">TENSOR_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">next_index</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">.pt&quot;</span>

            <span class="n">TENSOR_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span> <span class="n">tensor_file_path</span><span class="p">)</span>

            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;vertebra&quot;</span><span class="p">:</span> <span class="n">vertebra</span><span class="p">,</span>
                    <span class="s2">&quot;injury_type&quot;</span><span class="p">:</span> <span class="n">injury_type</span><span class="p">,</span>
                    <span class="s2">&quot;II&quot;</span><span class="p">:</span> <span class="n">II</span><span class="p">,</span>
                    <span class="s2">&quot;tensor_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">next_index</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">next_index</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.data_utils.dataset_creator.DatasetCreator.create_dataset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_dataset</span><span class="p">(</span><span class="n">target_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_healthy</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ignore_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Parse the report file and process DICOM data for each patient.</p>


<details class="this-function-reads-a-csv-file-where-each-row-contains" open>
  <summary>This function reads a CSV file where each row contains</summary>
  <ul>
<li>a patient directory identifier (may represent multiple patients),</li>
<li>a list of injured vertebrae with injury types.</li>
</ul>
</details>        <p>It extracts vertebra data for each patient and saves it using <code>process_patient</code>
and <code>save_patient_data</code>. If any part of the process fails for a patient,
others will still be processed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_size</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>, <span title="int">int</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional shape to which extracted vertebra tensors should be resized.
If None, original size is preserved.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_healthy</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of healthy vertebrae to extract.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ignore_existing</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, existing extracted data will be deleted.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/data_utils/dataset_creator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_dataset</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">target_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_healthy</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">ignore_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the report file and process DICOM data for each patient.</span>

<span class="sd">    This function reads a CSV file where each row contains:</span>
<span class="sd">        - a patient directory identifier (may represent multiple patients),</span>
<span class="sd">        - a list of injured vertebrae with injury types.</span>

<span class="sd">    It extracts vertebra data for each patient and saves it using `process_patient`</span>
<span class="sd">    and `save_patient_data`. If any part of the process fails for a patient,</span>
<span class="sd">    others will still be processed.</span>

<span class="sd">    Args:</span>
<span class="sd">        target_size (Optional[tuple[int, int, int]]):</span>
<span class="sd">            Optional shape to which extracted vertebra tensors should be resized.</span>
<span class="sd">            If None, original size is preserved.</span>
<span class="sd">        num_healthy (int): Number of healthy vertebrae to extract.</span>
<span class="sd">        ignore_existing (bool): If True, existing extracted data will be deleted.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ignore_existing</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">LABELS_FILE_PATH</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">LABELS_FILE_PATH</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">TENSOR_DIR</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">TENSOR_DIR</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted contents of tensor directory: </span><span class="si">{</span><span class="n">TENSOR_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">processed_patients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_processed_patients</span><span class="p">()</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raport_file_path</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="nb">next</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">reader</span><span class="p">):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">raw_injuries</span><span class="p">,</span> <span class="n">dir_id</span> <span class="o">=</span> <span class="n">row</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing dir id:</span><span class="si">{</span><span class="n">dir_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dir_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dir_name</span><span class="p">(</span><span class="n">dir_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">dir_name</span> <span class="ow">in</span> <span class="n">processed_patients</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">injuries</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">raw_injuries</span><span class="p">)</span>

            <span class="n">patient_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_patient</span><span class="p">(</span>
                <span class="n">dir_name</span><span class="o">=</span><span class="n">dir_name</span><span class="p">,</span>
                <span class="n">injuried_vertebrae</span><span class="o">=</span><span class="n">injuries</span><span class="p">,</span>
                <span class="n">target_size</span><span class="o">=</span><span class="n">target_size</span><span class="p">,</span>
                <span class="n">num_healthy</span><span class="o">=</span><span class="n">num_healthy</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_patient_data</span><span class="p">(</span><span class="n">patient_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>